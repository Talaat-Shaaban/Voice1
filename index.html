<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø°ÙƒÙŠ - Ù†Ø³Ø®Ø© Ù…Ø³ØªÙ‚Ø±Ø©</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px; background: #f0f2f5; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: inline-block; width: 90%; max-width: 450px; }
        #startBtn { padding: 15px 30px; font-size: 18px; cursor: pointer; border: none; border-radius: 10px; background: #e74c3c; color: white; transition: 0.3s; }
        #startBtn:disabled { background: #95a5a6; }
        #status { margin: 15px; color: #555; font-weight: bold; }
        #transcript { background: #eee; padding: 15px; border-radius: 10px; margin: 15px 0; min-height: 40px; }
        .score { font-size: 50px; color: #2ecc71; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>Ø§Ø®ØªØ¨Ø§Ø±: ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ</h2>
    <p id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹</p>
    <button id="startBtn">ğŸ¤ Ø§Ø¶ØºØ· Ù„Ù„ØªØ­Ø¯Ø«</button>
    <div id="transcript">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>
    <div id="result" style="display:none">
        <div id="feedback"></div>
        <div class="score" id="scoreValue">0</div>
    </div>
</div>

<script>
    const startBtn = document.getElementById('startBtn');
    const status = document.getElementById('status');
    const transcriptDiv = document.getElementById('transcript');
    const resultDiv = document.getElementById('result');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
        status.innerText = "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª. Ø¬Ø±Ø¨ Chrome.";
    } else {
        const recognition = new SpeechRecognition();
        recognition.lang = 'ar-SA';
        recognition.interimResults = true; // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø±Ø¤ÙŠØ© Ø§Ù„ÙƒÙ„Ø§Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯Ø«
        recognition.maxAlternatives = 1;

        startBtn.onclick = () => {
            recognition.start();
        };

        recognition.onstart = () => {
            startBtn.disabled = true;
            status.innerText = "Ø£Ù†Ø§ Ø£Ø³Ù…Ø¹Ùƒ Ø§Ù„Ø¢Ù†... ØªÙƒÙ„Ù… Ø¨ÙˆØ¶ÙˆØ­";
            transcriptDiv.innerText = "...";
            resultDiv.style.display = "none";
        };

        recognition.onresult = (event) => {
            let interimTranscript = '';
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                if (event.results[i].isFinal) {
                    const finalSpeech = event.results[i][0].transcript;
                    transcriptDiv.innerText = finalSpeech;
                    evaluate(finalSpeech);
                } else {
                    interimTranscript += event.results[i][0].transcript;
                    transcriptDiv.innerText = interimTranscript; // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ø§Ù… Ù„Ø­Ø¸ÙŠØ§Ù‹
                }
            }
        };

        recognition.onerror = (event) => {
            status.innerText = "Ø®Ø·Ø£: " + event.error;
            startBtn.disabled = false;
        };

        recognition.onend = () => {
            startBtn.disabled = false;
            if(status.innerText === "Ø£Ù†Ø§ Ø£Ø³Ù…Ø¹Ùƒ Ø§Ù„Ø¢Ù†... ØªÙƒÙ„Ù… Ø¨ÙˆØ¶ÙˆØ­") {
                status.innerText = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.";
            }
        };
    }

    function evaluate(text) {
        let score = 0;
        let msg = "";
        const t = text.toLowerCase();

        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†ÙÙŠ
        if (t.includes("Ù…Ø´") || t.includes("Ù„Ø§ ") || t.includes("Ù„ÙŠØ³")) {
            score = 0; msg = "Ø¥Ø¬Ø§Ø¨Ø© Ø³Ù„Ø¨ÙŠØ©";
        } else if (t.includes("Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡") || t.includes("ØªÙ…Ø§Ù…") || t.includes("Ø¨Ø®ÙŠØ±")) {
            score = 2; msg = "Ù…Ù…ØªØ§Ø²";
        } else if (t.includes("ÙƒÙˆÙŠØ³") || t.includes("Ù…Ø§Ø´ÙŠ") || t.includes("Ø·ÙŠØ¨")) {
            score = 1; msg = "Ù…Ù‚Ø¨ÙˆÙ„";
        } else {
            score = 0; msg = "ØºÙŠØ± Ù…ÙÙ‡ÙˆÙ…";
        }

        resultDiv.style.display = "block";
        document.getElementById('scoreValue').innerText = score;
        document.getElementById('feedback').innerText = msg;
        status.innerText = "ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­";
    }
</script>

</body>
</html>
